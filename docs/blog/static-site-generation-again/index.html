<html lang="en" dir="auto"><head><meta charset="UTF-8"></meta><meta name="generator" content="justshare"></meta><meta http-equiv="X-UA-Compatible" content="IE=edge"></meta><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"></meta><meta content="index, follow" name="robots"></meta><title>breadchris</title><meta name="description" content=""></meta><meta name="author" content="breadchris"></meta><link rel="canonical" href="https://breadchris.com/"></link><link href="https://breadchris.com/static/styles.css" crossorigin="anonymous" rel="preload stylesheet" as="style"></link><link rel="icon" href="https://breadchris.com/favicon.ico"></link><link href="https://breadchris.com/favicon-16x16.png" rel="icon" type="image/png" sizes="16x16"></link><link href="https://breadchris.com/favicon-32x32.png" rel="icon" type="image/png" sizes="32x32"></link><link href="https://breadchris.com/apple-touch-icon.png" rel="apple-touch-icon"></link><link href="https://breadchris.com/safari-pinned-tab.svg" rel="mask-icon"></link><meta content="#2e2e33" name="theme-color"></meta><meta name="msapplication-TileColor" content="#2e2e33"></meta><link href="https://breadchris.com/index.xml" rel="alternate" type="application/rss+xml"></link><link href="https://breadchris.com/index.json" rel="alternate" type="application/json"></link><meta content="breadchris" property="og:title"></meta><meta property="og:description" content=""></meta><meta property="og:type" content="website"></meta><meta content="https://breadchris.com" property="og:url"></meta><meta name="twitter:card" content="summary"></meta><meta name="twitter:title" content="breadchris"></meta><meta name="twitter:description" content=""></meta></head><body class="list dark vsc-initialized" id="top"><header class="header"><nav class="nav"><div class="logo"><a href="https://breadchris.com/" accesskey="h" title="breadchris (Alt + H)">breadchris</a><div class="entry-header"><button id="theme-toggle" accesskey="t" title="(Alt + T)"></button></div></div><ul id="menu"><li><a title="blog" href="https://breadchris.com/blog"><span>blog</span></a></li><li><a href="https://breadchris.com/resume" title="resume"><span>resume</span></a></li><li><a href="https://breadchris.com/tags/" title="tags"><span>tags</span></a></li><li><a href="https://breadchris.com/talks" title="talks"><span>talks</span></a></li></ul></nav></header><main class="main"><article class="post-single"><header class="post-header"><h1 class="post-title entry-hint-parent">Static Site Generation, Again</h1><div class="post-meta"><span title="2024-10-03T23:43:53-04:00">October 3, 2024</span><span class="ml-3">| breadchris</span></div></header><style>
			pre,code {
				tab-size: 2; /* SetMap the tab width to 4 spaces */
				/*white-space: pre; Preserve whitespace and line breaks */
			}
			</style><div class="post-content">&lt;p&gt;I got the static site generation working while working on the plane! It feels pretty hacker to be able to have a vision of what you want to work on and then have it come to life so quickly. The static site generation is especially exciting because I feel like I am that much closer to being able to host blogs for people with little to no cost to me. It would be great to be able to offer a super cheap hosting option for a blog.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;/data/uploads/3f675243-d839-4af8-8202-521e113a9559.png&#34; alt=&#34;Screenshot 2024-10-03 at 11.21.03 PM.png&#34;&gt;&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;I was surprised that I could drag and drop an image into this editor and have it just work (blocknotejs is dope) 2) I am realizing that images will not work properly on the blog, I will need to make sure their routes get rewritten.&lt;/li&gt;
&lt;/ol&gt;
&lt;h3&gt;some jank code&lt;/h3&gt;
&lt;p&gt;When you are writing a static site generator, you will eventually need to make sure the generated site knows what domain/URL/base path it is hosted from. For example, this blog is hosted on &lt;code&gt;https://breadchris.com&lt;/code&gt;. Locally, my generated site is hosted from &lt;code&gt;http://localhost:8080/data/sites/generated/breadchris.com/latest/&lt;/code&gt;. For local development, I need to make sure all links have the prefix &lt;code&gt;/data/sites/generated/breadchris.com/latest/&lt;/code&gt; since that is where the content is hosted on my computer. To get this to work within &lt;code&gt;godom&lt;/code&gt;, I could have prop drilled the URL throughout the DOM components, but I thought the dev experience would have been annoying since most hrefs or script srcs would depend on this. Instead, I felt it was better to have all links reference the root of the site (ex. /some/path) and then when the page is being rendered, modify the path so that it references the correct base URL. I called these &amp;quot;DynamicAttrs&amp;quot;, for a lack of a better term, and I really cannot figure out if this is stupid or not. It required no changes to the existing godom code I wrote for my blog&#39;s views, but it did require updating the html library.&lt;/p&gt;
&lt;p&gt;An &lt;code&gt;Href&lt;/code&gt; attribute will build itself just before rendering:&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;func Href(s string) *Node {
	return &amp;amp;Node{
		transform: func(p *Node) {
			p.DynamicAttrs[&amp;quot;href&amp;quot;] = func(ctx context.Context) string {
				if strings.HasPrefix(s, &amp;quot;/&amp;quot;) {
					if baseURL, ok := ctx.Value(&amp;quot;baseURL&amp;quot;).(string); ok {
						return baseURL + s
					} else {
						return &amp;quot;baseURL not found in ctx&amp;quot;
					}
				}
				return s
			}
		},
	}
}
&lt;/code&gt;&lt;/pre&gt;
&lt;!-- raw HTML omitted --&gt;
&lt;pre&gt;&lt;code&gt;ctx := context.WithValue(context.Background(), &amp;quot;baseURL&amp;quot;, &amp;quot;/data/sites/generated/breadchris.com/latest/&amp;quot;)
// ...
attrs := map[string]string{}
if s.locator != &amp;quot;&amp;quot; {
    attrs[&amp;quot;data-godom&amp;quot;] = s.locator
}
for k, v := range s.DynamicAttrs {
    attrs[k] = v(ctx)
}
for k, v := range s.Attrs {
    attrs[k] = v
}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;I totally almost just got sad, I hit back in my browser and thought I lost all of this writing...but past chris is a G, he totally has all of this state saved to local storage&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;async function saveToStorage(jsonBlocks: Block[]) {
    // Save contents to local storage. You might want to debounce this or replace
    // with a call to your API / database.
    localStorage.setItem(&amp;quot;editorContent&amp;quot;, JSON.stringify(jsonBlocks));
}

async function loadFromStorage() {
    // Gets the previously stored editor contents.
    const storageString = localStorage.getItem(&amp;quot;editorContent&amp;quot;);
    return storageString
        ? (JSON.parse(storageString) as PartialBlock[])
        : undefined;
}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;There was a distinct moment where I thought that adding the attr stuff in the way I did was stupid. And it might be! I had to remind myself that code isn&#39;t stupid if it gets the job done, and it did. I might have written some lame code, but at least I have a working feature now that brings me closer to providing someone value!&lt;/p&gt;
</div><script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.10.0/highlight.min.js"></script><script>hljs.highlightAll();</script><footer class="post-footer"><ul class="post-tags"><li class="post-tag"><a href="https://breadchris.com/tags/blog">blog</a></li><li class="post-tag"><a href="https://breadchris.com/tags/go">go</a></li></ul></footer></article></main><footer class="page-footer"></footer><footer class="footer"><span>© 2024 <a href="https://breadchris.com/">breadchris</a></span></footer></body></html>