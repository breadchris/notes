import { $APP, shadow$provide, $jscomp } from "./nbb_core.js";
import "./nbb_api.js";
const shadow_esm_import = function(x) { return import(x) };
import*as esm_import$net from"net";import*as esm_import$readline from"readline";import*as esm_import$vm from"vm";
var LS=function(a){var b=function(){var e=$APP.Mr.g(a,"(");return $APP.l(e)?new $APP.J(null,2,5,$APP.K,[$APP.Xj.j(a,0,e+1),$APP.Xj.g(a,e+1)],null):new $APP.J(null,2,5,$APP.K,[null,a],null)}(),c=$APP.B.j(b,0,null),d=$APP.B.j(b,1,null);b=$APP.D.g(function(){try{return $APP.tya(new $APP.k(null,2,[$APP.U,$APP.p.h($APP.q(KS)),$APP.CG,d],null))}catch(f){var e=f;console.warn($APP.p.h($APP.Sqa),$APP.gl(e));return null}}(),"completions");return $APP.ek.g(function(e){return[$APP.p.h(c),$APP.p.h(e)].join("")},
$APP.Yh(function(e){return $APP.Ca(e,d)},$APP.ek.g(function(e){return $APP.D.g(e,"candidate")},b)))},mBa=function(a){return[$APP.Ds.h(LS(a)),a]},PS=function(a,b){$APP.Fh(MS,!1);a.setPrompt([$APP.p.h($APP.q(KS)),"\x3d\x3e "].join(""));a.prompt();return $APP.em($APP.q(NS))?null:OS.g?OS.g(b,a):OS.call(null,b,a)},nBa=function(a){var b=$APP.rm(a);a=$APP.sm(a);var c=$APP.dm($APP.q(NS));b=$APP.Nh.g(b-1,c);c=$APP.u(b);b=$APP.v(c);c=$APP.y(c);a=$APP.l(b)?$APP.Xj.g(b,a):null;$APP.Fh(NS,$APP.Ep.g("\n",$APP.Bg(a,
c)))},oBa=function(a,b){b={f:b};esm_import$vm.createContext(b);try{return $APP.l($APP.l(QS)?$APP.vb(a):QS)&&process.stdin.setRawMode(!1),esm_import$vm.runInContext("f()",b,{displayErrors:!0,breakOnSigint:!0,microtaskMode:"afterEvaluate"}).then(function(c){var d={f:$APP.l(a)?function(){return c}:function(){var e=$APP.v(c);$APP.gt.l($APP.C([e]));return c}};esm_import$vm.createContext(d);return esm_import$vm.runInContext("f()",d,{displayErrors:!0,breakOnSigint:!0,microtaskMode:"afterEvaluate"})}).finally(function(){return $APP.l($APP.l(QS)?
$APP.vb(a):QS)?process.stdin.setRawMode(!0):null})}catch(c){return b=c,$APP.l($APP.l(QS)?$APP.vb(a):QS)&&process.stdin.setRawMode(!0),Promise.reject(b)}},OS=function(a,b){if($APP.l(function(){var e=$APP.q(MS);return $APP.l(e)?e:$APP.em($APP.q(NS))}()))return null;$APP.Fh(MS,!0);var c=$APP.Dp($APP.q(NS)),d=function(){try{var e=$APP.$g([$APP.Uq,$APP.q(KS)]);$APP.eq(e);try{return $APP.Via(c)}finally{$APP.gq()}}catch(f){e=f;if(-1!=$APP.gl(e).indexOf("EOF while reading"))return pBa;nBa(c);$APP.gt.l($APP.C([$APP.p.h(e)]));
return qBa}}();if($APP.A.g(qBa,d))return PS(b,a);if($APP.A.g(pBa,d))return $APP.Fh(MS,!1);nBa(c);if($APP.A.g($APP.nu,d))return $APP.Fh(MS,!1);$APP.eq($APP.$g([$APP.Uq,$APP.q(KS)]));return oBa(a,function(){return $APP.lya(d,new $APP.k(null,3,[$APP.U,$APP.q(KS),$APP.Pm,$APP.q($APP.Gq),$APP.oJ,$APP.iw],null))}).then(function(e){var f=$APP.B.j(e,0,null);e=$APP.B.j(e,1,null);e=$APP.bh(e);e=$APP.D.g(e,$APP.U);$APP.Fh(KS,e);$APP.UO.g($APP.DO,$APP.Bh($APP.q($APP.CO)));$APP.UO.g($APP.CO,$APP.Bh($APP.q($APP.BO)));
$APP.UO.g($APP.BO,$APP.Bh(f));$APP.l(a)&&a.write($APP.Dw.l($APP.C([f])));return PS(b,a)}).catch(function(e){$APP.gt.l($APP.C([$APP.p.h(e)]));$APP.UO.g($APP.EO,$APP.Bh(e));return PS(b,a)}).finally(function(){return $APP.gq()})},rBa=function(a,b){a.on("line",function(c){$APP.Bk.G(NS,$APP.p,c,"\n");return OS(b,a)})},sBa=function(a){return esm_import$readline.createInterface({input:a,output:a,completer:mBa})},tBa=function(a){var b=sBa(a);rBa(b,a);a.setNoDelay(!0);return a.on("close",function(){return $APP.Gw.l($APP.C(["Client closed connection."]))})},
RS=new $APP.t(null,"nbb.impl.repl","nbb.impl.repl",-339140484,null),pBa=new $APP.G("nbb.impl.repl","eof-while-reading","nbb.impl.repl/eof-while-reading",1743626215),uBa=new $APP.t("nbb.impl.repl","completer*","nbb.impl.repl/completer*",455172317,null),vBa=new $APP.t("nbb.impl.repl","repl","nbb.impl.repl/repl",-1645296655,null),wBa=new $APP.t(null,"completer*","completer*",-648150376,null),xBa=new $APP.t("nbb.impl.repl","socket-repl","nbb.impl.repl/socket-repl",1509490200,null),yBa=new $APP.G(null,
"init","init",-1875481434),zBa=new $APP.t(null,"get-completions","get-completions",1933789168,null),qBa=new $APP.G("nbb.impl.repl","continue","nbb.impl.repl/continue",-1326808644);var KS=$APP.Ak.h($APP.q($APP.Uq)),NS=$APP.Ak.h(""),MS=$APP.Ak.h(!1),QS,ABa=process.stdout.isTTY;QS=$APP.l(ABa)?process.stdin.setRawMode:ABa;process.binding("contextify");var SS=$APP.mu($APP.$w),TS=function TS(a){switch(arguments.length){case 0:return TS.C();case 1:return TS.h(arguments[0]);default:throw Error(["Invalid arity: ",$APP.p.h(arguments.length)].join(""));}};TS.C=function(){return TS.h(null)};
TS.h=function(a){var b=function(){var d=$APP.ZQ.h(a);return $APP.l(d)?d:0}(),c=esm_import$net.createServer(tBa);return c.listen(b,"127.0.0.1",function(){var d=c.address(),e=d.address;return $APP.Gw.l($APP.C([["Socket REPL listening on port ",$APP.p.h(d.port)," on host ",$APP.p.h(e)].join("")]))})};TS.B=1;var US=function US(a){switch(arguments.length){case 0:return US.C();case 1:return US.h(arguments[0]);default:throw Error(["Invalid arity: ",$APP.p.h(arguments.length)].join(""));}};US.C=function(){return US.h(null)};
US.h=function(a){function b(e){return $APP.jya(new $APP.E(null,$APP.xl,new $APP.E(null,new $APP.E(null,$APP.xl,new $APP.E(null,e,null,1,null),2,null),null,1,null),2,null))}$APP.l(QS)&&process.stdin.setRawMode(!0);var c=$APP.B.j($APP.XO,0,null),d=$APP.B.j($APP.XO,1,null);$APP.Gw.l($APP.C([["Welcome to nbb v",$APP.dv(),"!"].join("")]));return b(c).then(function(){return b(d)}).then(yBa.g(a,$APP.uf)).then(function(){return new Promise(function(e){var f=$APP.l(null)?sBa(null):esm_import$readline.createInterface({input:process.stdin,
output:process.stdout,completer:mBa});rBa(f,null);f.setPrompt([$APP.p.h($APP.q(KS)),"\x3d\x3e "].join(""));f.on("close",e);return f.prompt()})})};US.B=1;
var BBa=new $APP.k(null,3,[$APP.XQ,function(){var a=new $APP.Ld(function(){return US},vBa,$APP.kj([$APP.U,$APP.R,$APP.Pm,$APP.Jx,$APP.NI,$APP.In,$APP.Qm,$APP.qM,$APP.Y,$APP.Z,$APP.AD],[RS,$APP.XQ,"nbb/impl/repl.cljs",11,new $APP.k(null,6,[$APP.ky,!1,$APP.Xs,1,$APP.$K,1,$APP.qK,new $APP.J(null,2,5,$APP.K,[$APP.Xh,new $APP.J(null,1,5,$APP.K,[$APP.cF],null)],null),$APP.Y,$APP.N($APP.Xh,new $APP.J(null,1,5,$APP.K,[$APP.cF],null)),$APP.tD,$APP.N(null,null)],null),1,188,188,$APP.N($APP.Xh,new $APP.J(null,
1,5,$APP.K,[$APP.cF],null)),null,$APP.l(US)?US.J:null])),b=$APP.q(a);a=$APP.De(a);var c=$APP.l(null)?null:$APP.R.h(a),d=new $APP.k(null,4,[$APP.U,SS,$APP.R,c,$APP.Y,$APP.Y.h(a),$APP.Z,$APP.Z.h(a)],null);return $APP.l($APP.ar.h(a))?$APP.iu(c,b,d):$APP.l($APP.rq.h(a))?$APP.ju(c,b,d):$APP.hu(c,b,d)}(),zBa,function(){var a=new $APP.Ld(function(){return LS},uBa,$APP.kj([$APP.U,$APP.R,$APP.Pm,$APP.Jx,$APP.In,$APP.Qm,$APP.qM,$APP.Y,$APP.Z,$APP.AD],[RS,wBa,"nbb/impl/repl.cljs",17,1,15,15,$APP.N(new $APP.J(null,
1,5,$APP.K,[$APP.Qla],null)),"Given a line, returns a flat vector of completions",$APP.l(LS)?LS.J:null])),b=$APP.q(a);a=$APP.De(a);var c=$APP.l(null)?null:$APP.R.h(a),d=new $APP.k(null,4,[$APP.U,SS,$APP.R,c,$APP.Y,$APP.Y.h(a),$APP.Z,$APP.Z.h(a)],null);return $APP.l($APP.ar.h(a))?$APP.iu(c,b,d):$APP.l($APP.rq.h(a))?$APP.ju(c,b,d):$APP.hu(c,b,d)}(),$APP.WQ,function(){var a=new $APP.Ld(function(){return TS},xBa,$APP.kj([$APP.U,$APP.R,$APP.Pm,$APP.Jx,$APP.NI,$APP.In,$APP.Qm,$APP.qM,$APP.Y,$APP.Z,$APP.AD],
[RS,$APP.WQ,"nbb/impl/repl.cljs",18,new $APP.k(null,6,[$APP.ky,!1,$APP.Xs,1,$APP.$K,1,$APP.qK,new $APP.J(null,2,5,$APP.K,[$APP.Xh,new $APP.J(null,1,5,$APP.K,[$APP.cF],null)],null),$APP.Y,$APP.N($APP.Xh,new $APP.J(null,1,5,$APP.K,[$APP.cF],null)),$APP.tD,$APP.N(null,null)],null),1,173,173,$APP.N($APP.Xh,new $APP.J(null,1,5,$APP.K,[$APP.cF],null)),null,$APP.l(TS)?TS.J:null])),b=$APP.q(a);a=$APP.De(a);var c=$APP.l(null)?null:$APP.R.h(a),d=new $APP.k(null,4,[$APP.U,SS,$APP.R,c,$APP.Y,$APP.Y.h(a),$APP.Z,
$APP.Z.h(a)],null);return $APP.l($APP.ar.h(a))?$APP.iu(c,b,d):$APP.l($APP.rq.h(a))?$APP.ju(c,b,d):$APP.hu(c,b,d)}()],null);$APP.Wu(new $APP.k(null,1,[$APP.Rq,new $APP.k(null,1,[$APP.$w,BBa],null)],null));