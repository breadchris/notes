<html lang="en" dir="auto"><head ><meta charset="UTF-8"></meta><meta content="justshare" name="generator"></meta><meta http-equiv="X-UA-Compatible" content="IE=edge"></meta><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"></meta><meta name="robots" content="index, follow"></meta><title >breadchris</title><meta name="description" content=""></meta><meta name="author" content="breadchris"></meta><link href="http://localhost:8080/data/sites/generated/breadchris.com/latest/" rel="canonical"></link><link href="http://localhost:8080/data/sites/generated/breadchris.com/latest/static/styles.css" crossorigin="anonymous" rel="preload stylesheet" as="style"></link><link href="http://localhost:8080/data/sites/generated/breadchris.com/latest/favicon.ico" rel="icon"></link><link type="image/png" href="http://localhost:8080/data/sites/generated/breadchris.com/latest/favicon-16x16.png" sizes="16x16" rel="icon"></link><link sizes="32x32" rel="icon" href="http://localhost:8080/data/sites/generated/breadchris.com/latest/favicon-32x32.png" type="image/png"></link><link href="http://localhost:8080/data/sites/generated/breadchris.com/latest/apple-touch-icon.png" rel="apple-touch-icon"></link><link href="http://localhost:8080/data/sites/generated/breadchris.com/latest/safari-pinned-tab.svg" rel="mask-icon"></link><meta name="theme-color" content="#2e2e33"></meta><meta name="msapplication-TileColor" content="#2e2e33"></meta><link href="http://localhost:8080/data/sites/generated/breadchris.com/latest/index.xml" rel="alternate" type="application/rss+xml"></link><link rel="alternate" type="application/json" href="http://localhost:8080/data/sites/generated/breadchris.com/latest/index.json"></link><meta property="og:title" content="breadchris"></meta><meta property="og:description" content=""></meta><meta property="og:type" content="website"></meta><meta content="http://localhost:8080/data/sites/generated/breadchris.com/latest" property="og:url"></meta><meta name="twitter:card" content="summary"></meta><meta name="twitter:title" content="breadchris"></meta><meta content="" name="twitter:description"></meta></head><body id="top" data-godom="/Users/cthompson/figma/share/breadchris/breadchris.go:350" class="list dark vsc-initialized"><header data-godom="/Users/cthompson/figma/share/breadchris/breadchris.go:351" class="header"><nav data-godom="/Users/cthompson/figma/share/breadchris/breadchris.go:352" class="nav"><div data-godom="/Users/cthompson/figma/share/breadchris/breadchris.go:353" class="logo"><a accesskey="h" title="breadchris (Alt + H)" href="http://localhost:8080/data/sites/generated/breadchris.com/latest/">breadchris</a><div data-godom="/Users/cthompson/figma/share/breadchris/breadchris.go:355" class="entry-header"><button id="theme-toggle" accesskey="t" title="(Alt + T)"></button></div></div><ul id="menu"><li ><a title="blog" href="http://localhost:8080/data/sites/generated/breadchris.com/latest/blog"><span >blog</span></a></li><li ><a href="http://localhost:8080/data/sites/generated/breadchris.com/latest/resume" title="resume"><span >resume</span></a></li><li ><a href="http://localhost:8080/data/sites/generated/breadchris.com/latest/tags/" title="tags"><span >tags</span></a></li><li ><a href="http://localhost:8080/data/sites/generated/breadchris.com/latest/talks" title="talks"><span >talks</span></a></li></ul></nav></header><main data-godom="/Users/cthompson/figma/share/breadchris/breadchris.go:367" class="main"><article data-godom="/Users/cthompson/figma/share/breadchris/breadchris.go:234" class="post-single"><header data-godom="/Users/cthompson/figma/share/breadchris/breadchris.go:235" class="post-header"><h1 data-godom="/Users/cthompson/figma/share/breadchris/breadchris.go:236" class="post-title entry-hint-parent">a stupid bug</h1><div data-godom="/Users/cthompson/figma/share/breadchris/breadchris.go:237" class="post-meta"><span title="2024-02-29T09:46:31-08:00">February 29, 2024</span><span class="ml-3" data-godom="/Users/cthompson/figma/share/breadchris/breadchris.go:239">| breadchris</span></div></header><style >
			pre,code {
				tab-size: 2; /* Set the tab width to 4 spaces */
				/*white-space: pre; Preserve whitespace and line breaks */
			}
			</style><div data-godom="/Users/cthompson/figma/share/breadchris/breadchris.go:248" class="post-content"><blockquote>
<p>func (f *SQLiteFile) getTotalSize() (int64, error) {</p>
<p>query :=</p>
<p><code> SELECT COUNT(*), COALESCE(LENGTH(fragment), 0)</code></p>
<p><code> FROM file_fragments</code></p>
<p><code> WHERE file_id = (SELECT id FROM file_metadata WHERE path = ?)</code></p>
<p><code> ORDER BY fragment_index DESC</code></p>
<p><code> LIMIT 1</code></p>
<p>`</p>
<p><code> </code></p>
<p>rows, err := f.db.Query(query, f.path)</p>
<p>if err != nil {</p>
<p>return 0, errors.Wrapf(err, &quot;failed to query file: %s&quot;, f.path)</p>
<p>}</p>
<p>for <a href="http://rows.Next">rows.Next</a>() {</p>
<p>var count, lastFragmentSize int</p>
<p>err = rows.Scan(&amp;count, &amp;lastFragmentSize)</p>
<p>if err != nil {</p>
<p>return 0, err</p>
<p>}</p>
<p>totalSize := int64((count-1)* <em>fragmentSize</em> + lastFragmentSize)</p>
<p>return totalSize, nil</p>
<p>}</p>
<p>return 0, errors.Errorf(&quot;could not find file fragments for path: %s&quot;, f.path)</p>
<p>}</p>
</blockquote>
<p>This was the buggy code</p>
<blockquote>
<p>query :=</p>
<p><code>SELECT COUNT(*), COALESCE(LENGTH(fragment), 0)</code></p>
<p><code>FROM file_fragments</code></p>
<p><code>WHERE file_id = (SELECT id FROM file_metadata WHERE path = ?)</code></p>
<p><code>ORDER BY fragment_index DESC</code></p>
<p><code>LIMIT 1;</code></p>
<p>`</p>
</blockquote>
<p>the semi colon was causing the problem</p>
<p>the error was incredibly ineffective bad parameter or other API misuse: not an error (21)\nfailed to query file: asdf.png\</p>
<p>chatgpt session <a href="https://chat.openai.com/share/3d2b075f-55f3-4e5b-8b58-da65964da43b">https://chat.openai.com/share/3d2b075f-55f3-4e5b-8b58-da65964da43b</a> was somewhat helpful</p>
</div><script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.10.0/highlight.min.js"></script><script >hljs.highlightAll();</script><footer data-godom="/Users/cthompson/figma/share/breadchris/breadchris.go:253" class="post-footer"><ul data-godom="/Users/cthompson/figma/share/breadchris/breadchris.go:255" class="post-tags"><li class="post-tag" data-godom="/Users/cthompson/figma/share/breadchris/breadchris.go:257"><a href="http://localhost:8080/data/sites/generated/breadchris.com/latest/tags/go">go</a></li><li data-godom="/Users/cthompson/figma/share/breadchris/breadchris.go:257" class="post-tag"><a href="http://localhost:8080/data/sites/generated/breadchris.com/latest/tags/bug">bug</a></li></ul></footer></article></main><footer data-godom="/Users/cthompson/figma/share/breadchris/breadchris.go:370" class="page-footer"></footer><footer data-godom="/Users/cthompson/figma/share/breadchris/breadchris.go:374" class="footer"><span >Â© 2024 <a href="http://localhost:8080/data/sites/generated/breadchris.com/latest/">breadchris</a></span></footer></body></html>