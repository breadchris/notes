<html lang="en" dir="auto"><head><meta charset="UTF-8"></meta><meta name="generator" content="justshare"></meta><meta http-equiv="X-UA-Compatible" content="IE=edge"></meta><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"></meta><meta name="robots" content="index, follow"></meta><title>breadchris</title><meta name="description" content=""></meta><meta name="author" content="breadchris"></meta><link href="https://breadchris.com/" rel="canonical"></link><link href="https://breadchris.com/static/styles.css" rel="preload stylesheet" as="style" crossorigin="anonymous"></link><link rel="icon" href="https://breadchris.com/favicon.ico"></link><link rel="icon" type="image/png" sizes="16x16" href="https://breadchris.com/favicon-16x16.png"></link><link href="https://breadchris.com/favicon-32x32.png" rel="icon" type="image/png" sizes="32x32"></link><link rel="apple-touch-icon" href="https://breadchris.com/apple-touch-icon.png"></link><link href="https://breadchris.com/safari-pinned-tab.svg" rel="mask-icon"></link><meta name="theme-color" content="#2e2e33"></meta><meta name="msapplication-TileColor" content="#2e2e33"></meta><link href="https://breadchris.com/index.xml" rel="alternate" type="application/rss+xml"></link><link href="https://breadchris.com/index.json" type="application/json" rel="alternate"></link><meta property="og:title" content="breadchris"></meta><meta property="og:description" content=""></meta><meta property="og:type" content="website"></meta><meta content="https://breadchris.com" property="og:url"></meta><meta name="twitter:card" content="summary"></meta><meta name="twitter:title" content="breadchris"></meta><meta name="twitter:description" content=""></meta></head><body class="list dark vsc-initialized" id="top"><header class="header"><nav class="nav"><div class="logo"><a accesskey="h" title="breadchris (Alt + H)" href="https://breadchris.com/">breadchris</a><div class="entry-header"><button id="theme-toggle" accesskey="t" title="(Alt + T)"></button></div></div><ul id="menu"><li><a href="https://breadchris.com/blog" title="blog"><span>blog</span></a></li><li><a title="resume" href="https://breadchris.com/resume"><span>resume</span></a></li><li><a href="https://breadchris.com/tags/" title="tags"><span>tags</span></a></li><li><a href="https://breadchris.com/talks" title="talks"><span>talks</span></a></li></ul></nav></header><main class="main"><article class="post-single"><header class="post-header"><h1 class="post-title entry-hint-parent">What is a good refactoring task?</h1><div class="post-meta"><span title="2024-01-20T23:35:47Z">January 20, 2024</span><span class="ml-3">| breadchris</span></div></header><style>
			pre,code {
				tab-size: 2; /* SetMap the tab width to 4 spaces */
				/*white-space: pre; Preserve whitespace and line breaks */
			}
			</style><div class="post-content"><p>There has been a <a href="https://github.com/lunabrain-ai/lunabrain/blob/54ddc68f80bf8d4a8978aa73f84f994b41bec410/js/site/form/ProtobufMessageForm.tsx">part of this code</a> that I have been wanting to refactor for a while. Patch on patch of this form has left this code in disarray. This code is actually quite important to this site as well. It is a general application form that leverages the power of Protobuf's expressive type system to generate a form a user can interact with. I have some ideas for where I want to take this code, but they haven't been a priority. The form worked well enough, until it didn't.</p>
<p>I went to use the form today to try to enter in some information and I encountered a problem. If a map was referenced in the form, it would not save properly due to how the data was being serialized and sent:</p>
<p>```</p>
<p>{ &quot;key&quot;: &quot;some key&quot;, &quot;value&quot;: &quot;some value&quot; }</p>
<p>```</p>
<p>should have been</p>
<p>```</p>
<p>{ &quot;some key&quot;: &quot;some value&quot; }</p>
<p>```</p>
<p>Because of how this code was written, there was not a strong separation of concerns, which was a concern. Since this is a bug that is stopping a critical flow through this app, I had to resolve it. There were 2 options: tack on another patch or rewrite it sanely. When I code, I have shifted over the years to favor the former. When you can afford to write a patch, it is usually faster to implement and you can keep things moving. Just make sure you leave notes along the way, future you will thank you. Additionally, writing a patch doesn't stop you from rewriting. It is possible that by going through the exercise of adding the patch, you are able to load enough of the code into your head to more efficiently rewrite the code.</p>
<p>I started with attempting a patch. I am currently the sole developer of this codebase and so far patches to this form have been able to get me by. Reading through the code to track down the problem, I realized just how deep the problem is rooted. To patch on a solution would be more of a dirty, dirty hack to get it working. I didn't even bother thinking all the way through how I would have gotten it working because of how complicated it seemed. The stars had aligned to give this code a proper rewrite.</p>
<p>I rewrote this code to be as functional and generic as possible so that it could be reused for different purposes. It has been a while since I have as proud as I was to write this function. I felt myself tapping into some distant knowledge I had on functional ocaml as I wrote this. The solution was elegant and exactly what I needed. Opting for the rewrite was not free, it took time. The trade of time for this code was well worth taking and future me will be very grateful.</p>
</div><script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.10.0/highlight.min.js"></script><script>hljs.highlightAll();</script><footer class="post-footer"><ul class="post-tags"><li class="post-tag"><a href="https://breadchris.com/tags/100daystooffload">100daystooffload</a></li></ul></footer></article></main><footer class="page-footer"></footer><footer class="footer"><span>Â© 2024 <a href="https://breadchris.com/">breadchris</a></span></footer></body></html>