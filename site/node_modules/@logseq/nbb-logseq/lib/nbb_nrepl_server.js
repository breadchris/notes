import { $APP, shadow$provide, $jscomp } from "./nbb_core.js";
import "./nbb_api.js";
import "./nbb_goog_string.js";
import "./nbb_pprint.js";
const shadow_esm_import = function(x) { return import(x) };
import*as esm_import$fs from"fs";import*as esm_import$net from"net";import*as esm_import$path from"path";
var mJa=function(a,b){a=a.indexOf(b);if(0>a)throw Error("out of input");return a},bY=function(a,b){if(a.length<b)throw Error("out of input");return a.slice(b)},cY=function(a,b){if(b>a.length)throw Error("out of input");return a.slice(0,b)},dY=function(a){return $APP.l($APP.Bu.h($APP.q($APP.WO)))?console.debug($APP.Ep.g(" ",a)):null},oJa=function(a){return function(b,c){b=$APP.bh(b);var d=$APP.D.g(b,$APP.Nq),e=$APP.D.g(b,nJa);c=$APP.yj.j(c,"id",d);c=$APP.l(e)?$APP.yj.j(c,"session",e):c;return a.g?
a.g(b,c):a.call(null,b,c)}},qJa=function(){var a=pJa;return function(b,c){b=$APP.Tn.j(b,$APP.UG,$APP.fk);return a.g?a.g(b,c):a.call(null,b,c)}},sJa=function(){var a=rJa();return function(b,c){dY($APP.C(["request",b]));return a.g?a.g(b,c):a.call(null,b,c)}},tJa=function(a){return function(b,c){dY($APP.C(["response",c]));return a.g?a.g(b,c):a.call(null,b,c)}},rJa=function(){var a=qJa();return function(b,c){return a.g?a.g(b,c):a.call(null,b,c)}},uJa=function(a){return $APP.yj.j($APP.Ij(new $APP.J(null,
3,5,$APP.K,["major","minor","incremental"],null),$APP.Qw.h(a.split("."))),"version-string",a)},vJa=function(a,b,c){if($APP.l(a))if(a=eY.h?eY.h(a):eY.call(null,a),$APP.l(a)){b=$APP.bh(b);var d=$APP.D.g(b,$APP.PIa),e=$APP.D.g(b,$APP.BX),f=$APP.D.g(b,$APP.DX);b=$APP.ib;var g=$APP.Zj,m=$APP.TV;$APP.ib=e;$APP.Zj=f;$APP.TV=d;try{var r=new $APP.Wa;d=$APP.kb;e=$APP.mb;$APP.kb=!0;$APP.mb=function(n){return r.append(n)};try{a.h?a.h(c):a.call(null,c)}finally{$APP.mb=e,$APP.kb=d}return $APP.p.h(r)}finally{$APP.TV=
m,$APP.Zj=g,$APP.ib=b}}else return dY($APP.C(["Pretty-Printing is only supported for clojure.core/prn and clojure.pprint/pprint."])),$APP.yk.l($APP.C([c]));else return $APP.yk.l($APP.C([c]))},wJa=function(a,b,c){$APP.UO.g($APP.EO,$APP.Bh(c));var d=$APP.Qq.h($APP.fl(c));d=$APP.l(d)?d:c.message;$APP.l(d)&&(d=new $APP.k(null,1,["err",[$APP.p.h(d),"\n"].join("")],null),a.g?a.g(b,d):a.call(null,b,d));c=new $APP.k(null,2,["ex",$APP.p.h(c),"ns",$APP.p.h($APP.q($APP.Uq))],null);return a.g?a.g(b,c):a.call(null,
b,c)},BJa=function(a,b){var c=$APP.bh(a),d=$APP.D.g(c,$APP.U);a=$APP.D.g(c,fY);var e=$APP.D.g(c,$APP.Pm);$APP.D.g(c,xJa);$APP.D.g(c,yJa);var f=$APP.Dp(a),g=function n(r){try{var w=function(){var z=$APP.U.h($APP.re(r));if($APP.l(z))return z;z=$APP.q(gY);return $APP.l(z)?z:d}(),x=$APP.Wia(f,new $APP.k(null,3,[$APP.U,w,$APP.Pm,e,$APP.oJ,$APP.iw],null));return $APP.A.g($APP.nu,x)?Promise.resolve(r):$APP.lya(x,new $APP.k(null,3,[$APP.U,w,$APP.Pm,e,$APP.oJ,$APP.iw],null)).then(function(z){var F=$APP.B.j(z,
0,null),M=$APP.B.j(z,1,null);M=$APP.U.h(M);$APP.Fh(gY,M);$APP.UO.g($APP.DO,$APP.Bh($APP.q($APP.CO)));$APP.UO.g($APP.CO,$APP.Bh($APP.q($APP.BO)));$APP.UO.g($APP.BO,$APP.Bh(F));F=vJa(zJa.h(c),AJa.h(c),F);F=new $APP.k(null,2,["value",F,"ns",$APP.p.h(M)],null);b.g?b.g(c,F):b.call(null,c,F);return n(z)})}catch(z){return wJa(b,c,z),n(null)}};$APP.eq($APP.$g([$APP.Uq,d,$APP.Gq,e,$APP.sN,$APP.q($APP.sN),$APP.xN,!0]));return function(){$APP.UO.g($APP.qN,$APP.Bh(function(r){r=new $APP.k(null,1,["out",r],null);
return b.g?b.g(c,r):b.call(null,c,r)}));return g(null).catch($APP.Jm.j(wJa,b,c)).finally(function(){var r=new $APP.k(null,2,["ns",$APP.p.h($APP.q(gY)),"status",new $APP.J(null,1,5,$APP.K,["done"],null)],null);return b.g?b.g(c,r):b.call(null,c,r)})}().finally(function(){return $APP.gq()})},CJa=function(a,b){a=$APP.bh(a);var c=$APP.D.g(a,$APP.U),d=$APP.yj.j;c=$APP.l(c)?$APP.TQ($APP.Eu(),$APP.ok.h(c)):null;$APP.l(c)||(c=$APP.q(gY),c=$APP.l(c)?c:$APP.q($APP.Uq));return BJa(d.call($APP.yj,a,$APP.U,c),
b)},hY=function(a,b){var c=$APP.bh(a),d=$APP.D.g(c,$APP.U),e=$APP.UG.h(c);try{var f=$APP.U.h(c),g=function(){var M=$APP.Fma.h(c);return $APP.l(M)?M:$APP.wn.h(c)}(),m=function(){var M=$APP.l(d)?$APP.TQ($APP.Eu(),$APP.ok.h(d)):null;if($APP.l(M))return M;M=$APP.q(gY);return $APP.l(M)?M:$APP.q($APP.Uq)}(),r=$APP.$g([$APP.Uq,m]);$APP.eq(r);try{var n=$APP.PQ($APP.Eu(),$APP.$U("\n(let [ns '%s\n      full-sym '%s]\n  (when-let [v (ns-resolve ns full-sym)]\n    (let [m (meta v)]\n      (assoc m :arglists (:arglists m)\n       :doc (:doc m)\n       :name (:name m)\n       :ns (some-\x3e m :ns ns-name)\n       :val @v))))",
f,g)),w=$APP.Z.h(n),x=$APP.Pm.h(n),z=$APP.Qm.h(n),F=function(){var M=e instanceof $APP.G?e.S:null;switch(M){case "eldoc":return M=new $APP.k(null,5,["ns",$APP.U.h(n),"name",$APP.R.h(n),"eldoc",$APP.vq.g(function(T){return $APP.vq.g($APP.p,T)},$APP.Y.h(n)),"type",$APP.Xe($APP.su.h(n))?"function":"variable","status",new $APP.J(null,1,5,$APP.K,["done"],null)],null),$APP.l(w)?$APP.yj.j(M,"docstring",w):M;case "info":case "lookup":return M=new $APP.k(null,4,["ns",$APP.U.h(n),"name",$APP.R.h(n),"arglists-str",
$APP.Ep.g("\n",$APP.ek.g($APP.yk,$APP.Y.h(n))),"status",new $APP.J(null,1,5,$APP.K,["done"],null)],null),M=$APP.l(w)?$APP.yj.j(M,"doc",w):M,M=$APP.l(x)?$APP.yj.j(M,"file",x):M,$APP.l(z)?$APP.yj.j(M,"line",z):M;default:throw Error(["No matching clause: ",$APP.p.h(M)].join(""));}}();return b.g?b.g(c,F):b.call(null,c,F)}finally{$APP.gq()}}catch(M){if(M instanceof Error)return a=M,f=function(){var T=new $APP.Bj(null,new $APP.k(null,1,["done",null],null),null);return $APP.A.g(e,DJa)?$APP.vg.g(T,"no-eldoc"):
T}(),a=new $APP.k(null,2,["status",f,"ex",$APP.p.h(a)],null),b.g?b.g(c,a):b.call(null,c,a);throw M;}},pJa=function(a,b){a=$APP.bh(a);var c=$APP.D.g(a,$APP.UG),d=$APP.D.g(EJa,c);if($APP.l(d))return d.g?d.g(a,b):d.call(null,a,b);console.warn($APP.Ep.g(" ",$APP.C(["Unhandled operation",c])));c=new $APP.k(null,1,["status",new $APP.J(null,3,5,$APP.K,["error","unknown-op","done"],null)],null);return b.g?b.g(a,c):b.call(null,a,c)},FJa=function(a){return function(b,c){return a.write(iY(c))}},GJa=function(a,
b){dY($APP.C(["Connection accepted"]));b.setNoDelay(!0);var c=sJa(),d=oJa(tJa(FJa(b))),e=$APP.Ak.h(null);b.on("data",function(f){var g=$APP.q(e);if($APP.l(g)){f=[$APP.p.h(g),$APP.p.h(f)].join("");$APP.Fh(e,null);var m=f}else m=f;a:for(f=$APP.C([$APP.Rw,!0]),g=$APP.Xh;;){var r=$APP.zh.j(jY,m,f);m=$APP.B.j(r,0,null);r=$APP.B.j(r,1,null);if(null==m){g=new $APP.J(null,2,5,$APP.K,[g,r],null);break a}g=$APP.vg.g(g,m);m=r}f=$APP.B.j(g,0,null);g=$APP.B.j(g,1,null);$APP.em(g)||$APP.Fh(e,g);f=$APP.u(f);g=null;
for(var n=r=0;;)if(n<r)m=g.ea(null,n),c(m,d),n+=1;else if(f=$APP.u(f))g=f,$APP.Pe(g)?(f=$APP.hd(g),r=$APP.id(g),g=f,m=$APP.me(f),f=r,r=m):(m=$APP.v(g),c(m,d),f=$APP.y(g),g=null,r=0),n=0;else return null});return b.on("close",function(f){return $APP.l(f)?dY($APP.C(["Connection lost"])):dY($APP.C(["Connection closed"]))})},kY=function(a){return Promise.resolve($APP.SQ(esm_import$path.resolve("script.cljs"),null)).then(function(){function b(e){return $APP.jya(new $APP.E(null,$APP.xl,new $APP.E(null,
new $APP.E(null,$APP.xl,new $APP.E(null,e,null,1,null),2,null),null,1,null),2,null))}var c=$APP.B.j($APP.XO,0,null),d=$APP.B.j($APP.XO,1,null);return b(c).then(function(){return b(d)})}).then(function(){var b=$APP.Hm.l($APP.C([$APP.q($APP.WO),a])),c=function(){var f=$APP.ZQ.h(b);return $APP.l(f)?f:0}(),d=function(){var f=$APP.uya.h(b);return $APP.l(f)?f:"127.0.0.1"}();(function(){var f=$APP.xb(b)?b.nl:HJa.h(b);return $APP.l(f)?f:"info"})();var e=esm_import$net.createServer($APP.Jm.g(GJa,$APP.ah));
e.listen(c,d,function(){var f=e.address(),g=f.port;f=f.address;$APP.Gw.l($APP.C([["nREPL server started on port ",$APP.p.h(g)," on host ",$APP.p.h(f)," - nrepl://",$APP.p.h(f),":",$APP.p.h(g)].join("")]));try{return esm_import$fs.writeFileSync(".nrepl-port",$APP.p.h(g))}catch(m){return console.warn($APP.Ep.g(" ",$APP.C(["Could not write .nrepl-port",m])))}});return $APP.Fh(IJa,e)})},JJa=new $APP.t("nbb.impl.nrepl-server","stop-server!","nbb.impl.nrepl-server/stop-server!",1628751782,null),AJa=new $APP.G("nrepl.middleware.print",
"options","nrepl.middleware.print/options",868480159),KJa=new $APP.t(null,"nbb.impl.nrepl-server","nbb.impl.nrepl-server",-1821079079,null),nJa=new $APP.G(null,"session","session",1008279103),LJa=new $APP.t("nbb.impl.nrepl-server","start-server!","nbb.impl.nrepl-server/start-server!",-2119141227,null),MJa=new $APP.G(null,"load-file","load-file",-424586670),fY=new $APP.G(null,"code","code",1586293142),HJa=new $APP.G(null,"log_level","log_level",-1756736313),zJa=new $APP.G("nrepl.middleware.print",
"print","nrepl.middleware.print/print",-1616742548),NJa=new $APP.G(null,"clone","clone",711747572),OJa=new $APP.G(null,"close","close",1835149582),PJa=new $APP.G(null,"info","info",-317069002),QJa=new $APP.G(null,"macroexpand","macroexpand",-130598183),RJa=new $APP.G(null,"complete","complete",-500388775),yJa=new $APP.G(null,"_line","_line",232847719),lY=new $APP.t(null,"server","server",-1155245649,null),SJa=new $APP.G(null,"lookup","lookup",1225356838),TJa=new $APP.G(null,"expander","expander",
379138924),xJa=new $APP.G(null,"_load-file?","_load-file?",-1198848711),UJa=new $APP.G(null,"describe","describe",1369790582),DJa=new $APP.G(null,"eldoc","eldoc",-1321421900),VJa=new $APP.t(null,"stop-server!","stop-server!",-410772185,null),WJa=new $APP.G(null,"load-file?","load-file?",1892536169);var mY=function mY(a,b){switch($APP.p.h(cY(a,1))){case "i":return a=bY(a,1),b=mJa(a,"e"),new $APP.J(null,2,5,$APP.K,[parseInt(cY(a,b)),bY(a,b+1)],null);case "l":var d=a=bY(a,1);for(a=$APP.Yc($APP.Xh);;){if($APP.A.g($APP.p.h(cY(d,1)),"e"))return new $APP.J(null,2,5,$APP.K,[$APP.$c(a),bY(d,1)],null);var e=mY.g?mY.g(d,b):mY.call(null,d,b),f=$APP.B.j(e,0,null),g=$APP.B.j(e,1,null);e=g;a=$APP.Wh.g(a,f);d=e}case "d":for(a=bY(a,1),f=$APP.bh(b),f=$APP.D.g(f,$APP.Rw),d=a,e=$APP.Yc($APP.ah);;){if($APP.A.g($APP.p.h(cY(d,
1)),"e"))return new $APP.J(null,2,5,$APP.K,[$APP.$c(e),bY(d,1)],null);a=mY.g?mY.g(d,b):mY.call(null,d,b);d=$APP.B.j(a,0,null);g=$APP.B.j(a,1,null);g=mY.g?mY.g(g,b):mY.call(null,g,b);a=$APP.B.j(g,0,null);g=$APP.B.j(g,1,null);d=$APP.l(f)?$APP.fk.h(d):d;a=$APP.Li.j(e,d,a);d=g;e=a}default:return b=mJa(a,":"),f=parseInt(cY(a,b)),a=bY(a,b+1),new $APP.J(null,2,5,$APP.K,[$APP.p.h(cY(a,f)),bY(a,f)],null)}},jY=function jY(a){for(var c=[],d=arguments.length,e=0;;)if(e<d)c.push(arguments[e]),e+=1;else break;
return jY.l(arguments[0],1<c.length?new $APP.Nd(c.slice(1),0,null):null)};jY.l=function(a,b){try{return mY(a,b)}catch(c){if(c instanceof Error)return new $APP.J(null,2,5,$APP.K,[null,a],null);throw c;}};jY.B=1;jY.F=function(a){var b=$APP.v(a);a=$APP.y(a);return this.l(b,a)};
var iY=function iY(a){for(;;){if("string"===typeof a)return[$APP.p.h(Buffer.from(a).length),":",a].join("");if(a instanceof $APP.G||a instanceof $APP.t)a=[function(){var c=$APP.Dg(a);return $APP.l(c)?[c,"/"].join(""):null}(),$APP.Hj(a)].join("");else return"number"===typeof a?["i",$APP.p.h(a),"e"].join(""):$APP.Ie(a)||$APP.Oe(a)||null==a?["l",$APP.p.h($APP.zh.g($APP.p,$APP.ek.g(iY,a))),"e"].join(""):$APP.Me(a)?["d",$APP.p.h($APP.zh.g($APP.p,$APP.ek.g(function(){return function(c){var d=$APP.B.j(c,
0,null);c=$APP.B.j(c,1,null);return[$APP.p.h(iY.h?iY.h(d):iY.call(null,d)),$APP.p.h(iY.h?iY.h(c):iY.call(null,c))].join("")}}(a),$APP.yv.g($APP.v,a)))),"e"].join(""):null}};var gY=$APP.Ak.h(null),eY=new $APP.k(null,1,["cider.nrepl.pprint/pprint",$APP.OX],null),EJa=$APP.kj([$APP.$Q,SJa,OJa,MJa,DJa,NJa,UJa,PJa,RJa,QJa,$APP.yqa],[function(a,b){var c=new $APP.k(null,2,["status",new $APP.J(null,1,5,$APP.K,["done"],null),"classpath",$APP.cm.g($APP.Gp(),$APP.Yj(esm_import$path.delimiter))],null);return b.g?b.g(a,c):b.call(null,a,c)},hY,function(a,b){var c=new $APP.k(null,1,["status",new $APP.J(null,1,5,$APP.K,["done"],null)],null);return b.g?b.g(a,c):b.call(null,a,c)},function(a,
b){a=$APP.bh(a);var c=$APP.D.g(a,$APP.Pm);return BJa($APP.yj.l(a,fY,c,$APP.C([WJa,!0,$APP.U,$APP.q($APP.Uq)])),b)},hY,function(a,b){var c=new $APP.k(null,2,["new-session",$APP.p.h($APP.dl()),"status",new $APP.J(null,1,5,$APP.K,["done"],null)],null);return b.g?b.g(a,c):b.call(null,a,c)},function(a,b){var c=new $APP.k(null,4,["versions",new $APP.k(null,2,["nbb-nrepl",uJa("TODO"),"node",uJa(process.version)],null),"aux",$APP.ah,"ops",$APP.Ij($APP.ek.g($APP.Hj,$APP.uj(EJa)),$APP.yq.h($APP.ah)),"status",
new $APP.J(null,1,5,$APP.K,["done"],null)],null);return b.g?b.g(a,c):b.call(null,a,c)},hY,function(a,b){var c=$APP.tya(a);return b.g?b.g(a,c):b.call(null,a,c)},function(a,b){a=$APP.bh(a);var c=$APP.D.g(a,fY),d=$APP.D.g(a,TJa);try{return CJa($APP.yj.j(a,fY,["( ",$APP.p.h(d),"(quote ",$APP.p.h(c),"))"].join("")),function(e,f){var g=f.h?f.h("value"):f.call(null,"value");f=$APP.l(g)?$APP.yj.j(f,"expansion",g):f;return b.g?b.g(e,f):b.call(null,e,f)})}catch(e){if(e instanceof Error)return c=new $APP.k(null,
3,["ex",$APP.p.h(e),"ns",$APP.p.h($APP.q($APP.Uq)),"status",new $APP.J(null,1,5,$APP.K,["done"],null)],null),b.g?b.g(a,c):b.call(null,a,c);throw e;}},CJa]),IJa=$APP.Ak.h(null),nY=function nY(a){switch(arguments.length){case 0:return nY.C();case 1:return nY.h(arguments[0]);default:throw Error(["Invalid arity: ",$APP.p.h(arguments.length)].join(""));}};nY.C=function(){return nY.h($APP.q(IJa))};
nY.h=function(a){return a.close(function(){return $APP.l(esm_import$fs.existsSync(".nrepl-port"))?esm_import$fs.unlinkSync(".nrepl-port"):null})};nY.B=1;
var XJa=$APP.mu($APP.Ux),YJa=new $APP.k(null,2,[$APP.YQ,function(){var a=new $APP.Ld(function(){return kY},LJa,$APP.kj([$APP.U,$APP.R,$APP.Pm,$APP.Jx,$APP.In,$APP.Qm,$APP.qM,$APP.Y,$APP.Z,$APP.AD],[$APP.Ce(KJa,new $APP.k(null,1,[$APP.Z,"Original implementation taken from https://github.com/viesti/nrepl-cljs-sci."],null)),$APP.YQ,"nbb/impl/nrepl_server.cljs",20,1,326,326,$APP.N(new $APP.J(null,1,5,$APP.K,[$APP.cF],null)),"Start nRepl server. Accepts options either as JS object or Clojure map.",$APP.l(kY)?
kY.J:null])),b=$APP.q(a);a=$APP.De(a);var c=$APP.l(null)?null:$APP.R.h(a),d=new $APP.k(null,4,[$APP.U,XJa,$APP.R,c,$APP.Y,$APP.Y.h(a),$APP.Z,$APP.Z.h(a)],null);return $APP.l($APP.ar.h(a))?$APP.iu(c,b,d):$APP.l($APP.rq.h(a))?$APP.ju(c,b,d):$APP.hu(c,b,d)}(),VJa,function(){var a=new $APP.Ld(function(){return nY},JJa,$APP.kj([$APP.U,$APP.R,$APP.Pm,$APP.Jx,$APP.NI,$APP.In,$APP.Qm,$APP.qM,$APP.Y,$APP.Z,$APP.AD],[$APP.Ce(KJa,new $APP.k(null,1,[$APP.Z,"Original implementation taken from https://github.com/viesti/nrepl-cljs-sci."],
null)),VJa,"nbb/impl/nrepl_server.cljs",19,new $APP.k(null,6,[$APP.ky,!1,$APP.Xs,1,$APP.$K,1,$APP.qK,new $APP.J(null,2,5,$APP.K,[$APP.Xh,new $APP.J(null,1,5,$APP.K,[lY],null)],null),$APP.Y,$APP.N($APP.Xh,new $APP.J(null,1,5,$APP.K,[lY],null)),$APP.tD,$APP.N(null,null)],null),1,375,375,$APP.N($APP.Xh,new $APP.J(null,1,5,$APP.K,[lY],null)),null,$APP.l(nY)?nY.J:null])),b=$APP.q(a);a=$APP.De(a);var c=$APP.l(null)?null:$APP.R.h(a),d=new $APP.k(null,4,[$APP.U,XJa,$APP.R,c,$APP.Y,$APP.Y.h(a),$APP.Z,$APP.Z.h(a)],
null);return $APP.l($APP.ar.h(a))?$APP.iu(c,b,d):$APP.l($APP.rq.h(a))?$APP.ju(c,b,d):$APP.hu(c,b,d)}()],null);$APP.Wu(new $APP.k(null,1,[$APP.Rq,new $APP.k(null,1,[$APP.Ux,YJa],null)],null));