<html dir="auto" lang="en"><head><meta charset="UTF-8"></meta><meta name="generator" content="justshare"></meta><meta http-equiv="X-UA-Compatible" content="IE=edge"></meta><meta content="width=device-width, initial-scale=1, shrink-to-fit=no" name="viewport"></meta><meta name="robots" content="index, follow"></meta><title>breadchris</title><meta content="" name="description"></meta><meta name="author" content="breadchris"></meta><link href="https://breadchris.com/" rel="canonical"></link><link rel="preload stylesheet" as="style" href="https://breadchris.com/static/styles.css" crossorigin="anonymous"></link><link href="https://breadchris.com/favicon.ico" rel="icon"></link><link href="https://breadchris.com/favicon-16x16.png" rel="icon" type="image/png" sizes="16x16"></link><link type="image/png" sizes="32x32" href="https://breadchris.com/favicon-32x32.png" rel="icon"></link><link href="https://breadchris.com/apple-touch-icon.png" rel="apple-touch-icon"></link><link href="https://breadchris.com/safari-pinned-tab.svg" rel="mask-icon"></link><meta content="#2e2e33" name="theme-color"></meta><meta content="#2e2e33" name="msapplication-TileColor"></meta><link rel="alternate" type="application/rss+xml" href="https://breadchris.com/index.xml"></link><link rel="alternate" type="application/json" href="https://breadchris.com/index.json"></link><meta property="og:title" content="breadchris"></meta><meta property="og:description" content=""></meta><meta content="website" property="og:type"></meta><meta property="og:url" content="https://breadchris.com"></meta><meta content="summary" name="twitter:card"></meta><meta name="twitter:title" content="breadchris"></meta><meta name="twitter:description" content=""></meta></head><body class="list dark vsc-initialized" id="top"><header class="header"><nav class="nav"><div class="logo"><a href="https://breadchris.com/" accesskey="h" title="breadchris (Alt + H)">breadchris</a><div class="entry-header"><button id="theme-toggle" accesskey="t" title="(Alt + T)"></button></div></div><ul id="menu"><li><a href="https://breadchris.com/blog" title="blog"><span>blog</span></a></li><li><a href="https://breadchris.com/resume" title="resume"><span>resume</span></a></li><li><a href="https://breadchris.com/tags/" title="tags"><span>tags</span></a></li><li><a href="https://breadchris.com/talks" title="talks"><span>talks</span></a></li></ul></nav></header><main class="main"><article class="post-single"><header class="post-header"><h1 class="post-title entry-hint-parent">a stupid bug</h1><div class="post-meta"><span title="2024-02-29T09:46:31-08:00">February 29, 2024</span><span class="ml-3">| breadchris</span></div></header><style>
			pre,code {
				tab-size: 2; /* SetMap the tab width to 4 spaces */
				/*white-space: pre; Preserve whitespace and line breaks */
			}
			</style><div class="post-content">&lt;blockquote&gt;
&lt;p&gt;func (f *SQLiteFile) getTotalSize() (int64, error) {&lt;/p&gt;
&lt;p&gt;query :=&lt;/p&gt;
&lt;p&gt;&lt;code&gt; SELECT COUNT(*), COALESCE(LENGTH(fragment), 0)&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;&lt;code&gt; FROM file_fragments&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;&lt;code&gt; WHERE file_id = (SELECT id FROM file_metadata WHERE path = ?)&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;&lt;code&gt; ORDER BY fragment_index DESC&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;&lt;code&gt; LIMIT 1&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;`&lt;/p&gt;
&lt;p&gt;&lt;code&gt; &lt;/code&gt;&lt;/p&gt;
&lt;p&gt;rows, err := f.db.Query(query, f.path)&lt;/p&gt;
&lt;p&gt;if err != nil {&lt;/p&gt;
&lt;p&gt;return 0, errors.Wrapf(err, &amp;quot;failed to query file: %s&amp;quot;, f.path)&lt;/p&gt;
&lt;p&gt;}&lt;/p&gt;
&lt;p&gt;for &lt;a href=&#34;http://rows.Next&#34;&gt;rows.Next&lt;/a&gt;() {&lt;/p&gt;
&lt;p&gt;var count, lastFragmentSize int&lt;/p&gt;
&lt;p&gt;err = rows.Scan(&amp;amp;count, &amp;amp;lastFragmentSize)&lt;/p&gt;
&lt;p&gt;if err != nil {&lt;/p&gt;
&lt;p&gt;return 0, err&lt;/p&gt;
&lt;p&gt;}&lt;/p&gt;
&lt;p&gt;totalSize := int64((count-1)* &lt;em&gt;fragmentSize&lt;/em&gt; + lastFragmentSize)&lt;/p&gt;
&lt;p&gt;return totalSize, nil&lt;/p&gt;
&lt;p&gt;}&lt;/p&gt;
&lt;p&gt;return 0, errors.Errorf(&amp;quot;could not find file fragments for path: %s&amp;quot;, f.path)&lt;/p&gt;
&lt;p&gt;}&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;This was the buggy code&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;query :=&lt;/p&gt;
&lt;p&gt;&lt;code&gt;SELECT COUNT(*), COALESCE(LENGTH(fragment), 0)&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;&lt;code&gt;FROM file_fragments&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;&lt;code&gt;WHERE file_id = (SELECT id FROM file_metadata WHERE path = ?)&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;&lt;code&gt;ORDER BY fragment_index DESC&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;&lt;code&gt;LIMIT 1;&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;`&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;the semi colon was causing the problem&lt;/p&gt;
&lt;p&gt;the error was incredibly ineffective bad parameter or other API misuse: not an error (21)\nfailed to query file: asdf.png\&lt;/p&gt;
&lt;p&gt;chatgpt session &lt;a href=&#34;https://chat.openai.com/share/3d2b075f-55f3-4e5b-8b58-da65964da43b&#34;&gt;https://chat.openai.com/share/3d2b075f-55f3-4e5b-8b58-da65964da43b&lt;/a&gt; was somewhat helpful&lt;/p&gt;
</div><script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.10.0/highlight.min.js"></script><script>hljs.highlightAll();</script><footer class="post-footer"><ul class="post-tags"><li class="post-tag"><a href="https://breadchris.com/tags/go">go</a></li><li class="post-tag"><a href="https://breadchris.com/tags/bug">bug</a></li></ul></footer></article></main><footer class="page-footer"></footer><footer class="footer"><span>Â© 2024 <a href="https://breadchris.com/">breadchris</a></span></footer></body></html>